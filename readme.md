# åˆ†å¸ƒå¼é«˜å¯ç”¨æ•°æ®é‡‡é›†ä¸åˆ†æç³»ç»Ÿ

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªé¢å‘å·¥ä¸šè‡ªåŠ¨åŒ–åœºæ™¯çš„åˆ†å¸ƒå¼é«˜å¯ç”¨æ•°æ®é‡‡é›†ä¸åˆ†æç³»ç»Ÿã€‚ç³»ç»Ÿé€šè¿‡OPC UAåè®®å®ç°PLCè®¾å¤‡æ•°æ®é‡‡é›†ï¼Œé‡‡ç”¨å¾®æœåŠ¡æ¶æ„å’Œæ¶ˆæ¯é˜Ÿåˆ—è§£è€¦å¤„ç†æµç¨‹ï¼Œæä¾›ä½å»¶è¿Ÿã€é«˜å¯ç”¨çš„æ•°æ®æœåŠ¡ï¼Œä¸ºEMSç³»ç»Ÿæä¾›ç¨³å®šæ•°æ®æ”¯æ’‘ã€‚


## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Webç›‘æ§ä¸­å¿ƒï¼ˆEMSç³»ç»Ÿï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                æ•°æ®æœåŠ¡å±‚ï¼ˆData Serviceï¼‰                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   æŸ¥è¯¢API   â”‚  â”‚   å‘Šè­¦æœåŠ¡  â”‚  â”‚  ç»Ÿè®¡æœåŠ¡   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ REST/Protobuf
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               æ•°æ®å¤„ç†ä¸å­˜å‚¨å±‚ï¼ˆProcessingï¼‰                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Kafkaæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆè§£è€¦å±‚ï¼‰                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚        â”‚  å®æ—¶è®¡ç®—     â”‚ â”‚  æ‰¹å¤„ç†å¼•æ“   â”‚ â”‚  æ•°æ®æ¸…æ´—  â”‚ â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               æ•°æ®é‡‡é›†å±‚ï¼ˆIngestionï¼‰                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              OPC UA é‡‡é›†é›†ç¾¤ï¼ˆA/Bå†—ä½™ï¼‰              â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚    â”‚  Active Node          â”‚    Standby Node    â”‚  â”‚    â”‚
â”‚  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚    â”‚
â”‚  â”‚    â”‚  â”‚  open62541   â”‚     â”‚   â”‚  open62541   â”‚ â”‚  â”‚    â”‚
â”‚  â”‚    â”‚  â”‚    Client    â”‚â—„â”€â”€â”€â”€â”¼â”€â”€â–ºâ”‚    Client    â”‚ â”‚  â”‚    â”‚
â”‚  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                 â–¼             â–¼                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ OPC UA
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ç°åœºè®¾å¤‡å±‚ï¼ˆFieldï¼‰                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚             KepserverExï¼ˆOPC UA Gatewayï¼‰           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                    â”‚                    â”‚       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚
â”‚   â”‚  PLC 1   â”‚       â”‚    PLC 2    â”‚     â”‚  ä»ªè¡¨è®¾å¤‡  â”‚ â”‚
â”‚   â”‚  (1500)  â”‚       â”‚    (300)    â”‚     â”‚ï¼ˆæµé‡/æ¸©åº¦ï¼‰â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

- **ç¼–ç¨‹è¯­è¨€**: C++17
- **ç½‘ç»œé€šä¿¡**: epoll + Reactoræ¨¡å¼ã€TCP/IP
- **åè®®**: OPC UA (open62541)ã€Protocol Buffers
- **æ¶ˆæ¯é˜Ÿåˆ—**: Apache Kafka
- **ç¼“å­˜**: Redis 6.x
- **æ•°æ®åº“**: MySQL 8.0
- **å®¹å™¨åŒ–**: Dockerã€Docker Compose
- **æ—¥å¿—**: spdlog
- **å…¶ä»–**: çº¿ç¨‹æ± ã€é“¾å¼ç¼“å†²åŒºã€é›¶æ‹·è´æŠ€æœ¯

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. OPC UA æ•°æ®é‡‡é›†æ¨¡å—

**æŠ€æœ¯å®ç°**:
- åŸºäºopen62541åº“å®ç°OPC UA Client
- æ”¯æŒå¤šèŠ‚ç‚¹è®¢é˜…ä¸æ•°æ®é‡‡æ ·
- å®ç°è‡ªåŠ¨é‡è¿ä¸è®¢é˜…é‡å»ºæœºåˆ¶
- é…ç½®é‡‡æ ·/å‘å¸ƒå‘¨æœŸä¸deadbandç­–ç•¥

**å…³é”®ç‰¹æ€§**:
- æ”¯æŒè‡³å°‘1000ä¸ªTagçš„å¹¶å‘é‡‡é›†
- æ•°æ®é‡‡é›†å»¶è¿Ÿ < 100ms
- æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œæ•°æ®å®Œæ•´æ€§ > 99.99%

### 2. é«˜å¹¶å‘ç½‘ç»œæœåŠ¡æ¡†æ¶

**æŠ€æœ¯æ¶æ„**:
- Reactoræ¨¡å¼ + epoll I/Oå¤šè·¯å¤ç”¨
- ä¸»ä»Reactorçº¿ç¨‹æ¨¡å‹
- æ¯è¿æ¥ç‹¬ç«‹çš„è¯»å†™ç¼“å†²åŒº

**ç¼“å†²åŒºè®¾è®¡**:
```cpp
// é“¾å¼ç¼“å†²åŒºç»“æ„ç¤ºä¾‹
class ChainBuffer {
private:
    struct BufferNode {
        char* data;
        size_t capacity;
        size_t read_pos;
        size_t write_pos;
        BufferNode* next;
    };
    
    BufferNode* head_;
    BufferNode* tail_;
    // ... å®ç°åˆ†æ®µå›æ”¶å’Œé›¶æ‹·è´å‘é€
};
```

### 3. æ¶ˆæ¯æ€»çº¿ä¸æ•°æ®åºåˆ—åŒ–

**Kafkaé›†æˆ**:
- ä½¿ç”¨librdkafka C++å®¢æˆ·ç«¯
- å®ç°æ‰¹é‡å‘é€ä¸é‡è¯•æœºåˆ¶
- æ”¯æŒè‡³å°‘ä¸€æ¬¡æŠ•é€’è¯­ä¹‰

**Protobuf Schema**:
```protobuf
message DataPoint {
    string source_id = 1;      // æ•°æ®æºæ ‡è¯†
    string node_id = 2;        // OPC UAèŠ‚ç‚¹ID
    double value = 3;          // æ•°æ®å€¼
    int64 device_timestamp = 4; // è®¾å¤‡æ—¶é—´æˆ³
    int64 ingest_timestamp = 5; // é‡‡é›†æ—¶é—´æˆ³
    int32 quality = 6;         // æ•°æ®è´¨é‡
    map<string, string> tags = 7; // æ ‡ç­¾å…ƒæ•°æ®
}
```

### 4. é«˜å¯ç”¨ä¸å†—ä½™éƒ¨ç½²

**ä¸»å¤‡åˆ‡æ¢æœºåˆ¶**:
- åŸºäºRedisåˆ†å¸ƒå¼é”å®ç°Leader Election
- æ”¯æŒActive-Standbyå’ŒActive-Activeæ¨¡å¼
- æ•…éšœæ£€æµ‹ä¸è‡ªåŠ¨åˆ‡æ¢æ—¶é—´ < 5ç§’

**æ•°æ®å»é‡ç­–ç•¥**:
- Kafkaç”Ÿäº§è€…å¹‚ç­‰æ€§é…ç½®
- æ¶ˆè´¹è€…ç«¯åŸºäºæ—¶é—´çª—å£å»é‡
- Rediså¸ƒéš†è¿‡æ»¤å™¨è¾…åŠ©å»é‡

### 5. æ•°æ®å­˜å‚¨ä¸å¤„ç†

**Redisç¼“å­˜ç­–ç•¥**:
- æœ€æ–°æ•°æ®ç¼“å­˜ï¼ŒTTL=10åˆ†é’Ÿ
- çƒ­ç‚¹æ•°æ®é¢„åŠ è½½
- ç¼“å­˜å‡»ç©¿/é›ªå´©é˜²æŠ¤

**MySQLä¼˜åŒ–**:
- æ‰¹é‡å†™å…¥ï¼ˆæ¯æ‰¹æ¬¡1000æ¡ï¼‰
- æŒ‰æ—¶é—´åˆ†è¡¨ï¼ˆæ¯æœˆä¸€å¼ è¡¨ï¼‰
- å¤åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

### 6. å®¹å™¨åŒ–éƒ¨ç½²

**Dockeré…ç½®**:
```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM gcc:11 as builder
# æ„å»ºé˜¶æ®µ...

FROM ubuntu:20.04
# è¿è¡Œé˜¶æ®µ...
HEALTHCHECK --interval=30s --timeout=3s \
  CMD ./health_check.sh
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Docker 20.10+
- Docker Compose 2.0+
- è‡³å°‘8GBå†…å­˜
- Linux/macOSç³»ç»Ÿ

### ä¸€é”®éƒ¨ç½²

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/data-collection-system.git
cd data-collection-system

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f opcua-collector
```

### æ‰‹åŠ¨æ„å»º

```bash
# å®‰è£…ä¾èµ–
sudo apt-get install -y \
    libssl-dev \
    libopen62541-dev \
    librdkafka-dev \
    libprotobuf-dev \
    protobuf-compiler

# æ„å»ºé¡¹ç›®
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
make -j$(nproc)

# è¿è¡Œé‡‡é›†æœåŠ¡
./bin/opcua_collector --config ../config/config.yaml
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®æµ‹å€¼ |
|------|--------|--------|
| æ•°æ®é‡‡é›†å»¶è¿Ÿ | < 100ms | 85ms |
| ç³»ç»Ÿååé‡ | > 10k msg/s | 12k msg/s |
| å¯ç”¨æ€§ | 99.95% | 99.97% |
| æ•…éšœæ¢å¤æ—¶é—´ | < 30s | 25s |
| æ•°æ®å®Œæ•´æ€§ | 99.99% | 99.995% |

## ğŸ”§ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®æ–‡ä»¶

```yaml
# config/config.yaml
opcua:
  endpoint: "opc.tcp://kepserver:4840"
  security_mode: 1  # None
  subscription_interval: 1000  # ms
  deadband_absolute: 0.1  # ç»å¯¹æ­»åŒº
  deadband_relative: 0.01  # ç›¸å¯¹æ­»åŒº

kafka:
  bootstrap_servers: "kafka1:9092,kafka2:9092"
  topic: "opcua-data"
  acks: "all"
  retries: 3

redis:
  host: "redis-master"
  port: 6379
  connection_pool: 10

database:
  mysql_host: "mysql-primary"
  mysql_port: 3306
  batch_size: 1000
  flush_interval: 5000  # ms
```

## ğŸ§ª æµ‹è¯•ä¸éªŒè¯

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
cd build
ctest --output-on-failure
```

### é›†æˆæµ‹è¯•

```bash
# å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
docker-compose -f docker-compose.test.yml up -d

# è¿è¡Œé›†æˆæµ‹è¯•
./scripts/run_integration_tests.sh
```

### æ•…éšœåˆ‡æ¢æ¼”ç»ƒ

1. **ç½‘ç»œä¸­æ–­æµ‹è¯•**
```bash
# æ¨¡æ‹Ÿç½‘ç»œåˆ†åŒº
docker network disconnect data-network opcua-collector-a
# éªŒè¯å¤‡èŠ‚ç‚¹è‡ªåŠ¨æ¥ç®¡
```

2. **æœåŠ¡é‡å¯æµ‹è¯•**
```bash
# é‡å¯ä¸»é‡‡é›†èŠ‚ç‚¹
docker-compose restart opcua-collector-a
# éªŒè¯æ•°æ®ä¸ä¸¢å¤±
```

## ğŸ“ˆ ç›‘æ§ä¸å‘Šè­¦

### ç›‘æ§æŒ‡æ ‡

- **ç³»ç»Ÿçº§**: CPUã€å†…å­˜ã€ç£ç›˜IOã€ç½‘ç»œæµé‡
- **åº”ç”¨çº§**: é‡‡é›†å»¶è¿Ÿã€æ¶ˆæ¯é˜Ÿåˆ—ç§¯å‹ã€ç¼“å­˜å‘½ä¸­ç‡
- **ä¸šåŠ¡çº§**: æ•°æ®å®Œæ•´æ€§ã€å‘Šè­¦æ•°é‡ã€è®¾å¤‡åœ¨çº¿ç‡

### å‘Šè­¦è§„åˆ™

```yaml
# alerting/rules.yaml
rules:
  - alert: HighDataLatency
    expr: opcua_collect_duration_seconds > 0.5
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "æ•°æ®é‡‡é›†å»¶è¿Ÿè¿‡é«˜"
      
  - alert: KafkaConsumerLag
    expr: kafka_consumer_lag > 1000
    for: 10m
    labels:
      severity: critical
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
distributed-data-collection/
â”œâ”€â”€ code/
â”‚   â”œâ”€â”€ data_collector/        # æ•°æ®é‡‡é›†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ main.cpp
â”‚   â”‚   â”œâ”€â”€ opcua_client/      # OPC UAå®¢æˆ·ç«¯å­æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ client.cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ config.cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ data_point.cpp
â”‚   â”‚   â”‚   â””â”€â”€ data_collector.cpp
â”‚   â”‚   â””â”€â”€ kafka_producer/    # Kafkaç”Ÿäº§è€…å­æ¨¡å—
â”‚   â”‚       â”œâ”€â”€ kafka_producer.cpp
â”‚   â”‚       â””â”€â”€ kafka_producer.hpp
â”‚   â””â”€â”€ data_processor/        # æ•°æ®å¤„ç†æ¨¡å—
â”‚       â”œâ”€â”€ main.cpp
â”‚       â”œâ”€â”€ utilities/         # å·¥å…·æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ config.cpp/hpp # é…ç½®ç®¡ç†
â”‚       â”‚   â””â”€â”€ json_parser.cpp/hpp # JSONè§£æ
â”‚       â”œâ”€â”€ kafka_consumer/    # Kafkaæ¶ˆè´¹è€…å­æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ kafka_consumer.cpp
â”‚       â”‚   â””â”€â”€ kafka_consumer.hpp
â”‚       â””â”€â”€ redis_client/      # Rediså®¢æˆ·ç«¯å­æ¨¡å—
â”‚           â”œâ”€â”€ redis_client.cpp
â”‚           â””â”€â”€ redis_client.hpp
â”‚   â”œâ”€â”€ network/               # ç½‘ç»œæ¡†æ¶
â”‚   â”‚   â”œâ”€â”€ reactor.cpp
â”‚   â”‚   â”œâ”€â”€ thread_pool.cpp
â”‚   â”‚   â””â”€â”€ chain_buffer.cpp
â”‚   â”œâ”€â”€ messaging/             # æ¶ˆæ¯é˜Ÿåˆ—
â”‚   â”‚   â”œâ”€â”€ kafka_producer.cpp
â”‚   â”‚   â”œâ”€â”€ kafka_consumer.cpp
â”‚   â”‚   â””â”€â”€ protobuf_schema.cpp
â”‚   â”œâ”€â”€ storage/               # å­˜å‚¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ redis_cache.cpp
â”‚   â”‚   â”œâ”€â”€ mysql_writer.cpp
â”‚   â”‚   â””â”€â”€ batch_processor.cpp
â”‚   â””â”€â”€ ha/                    # é«˜å¯ç”¨æ¨¡å—
â”‚       â”œâ”€â”€ leader_election.cpp
â”‚       â”œâ”€â”€ failover.cpp
â”‚       â””â”€â”€ health_check.cpp
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶
â”œâ”€â”€ docker/                    # Dockeré…ç½®
â”œâ”€â”€ tests/                     # æµ‹è¯•ä»£ç 
â”œâ”€â”€ scripts/                   # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â””â”€â”€ third_party/               # ç¬¬ä¸‰æ–¹ä¾èµ–
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **OPC UAè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥KepserverExæœåŠ¡çŠ¶æ€
   docker-compose logs kepserver
   
   # éªŒè¯ç½‘ç»œè¿é€šæ€§
   docker exec opcua-collector ping kepserver
   ```

2. **Kafkaæ¶ˆæ¯ç§¯å‹**
   ```bash
   # æŸ¥çœ‹æ¶ˆè´¹è€…ç»„çŠ¶æ€
   kafka-consumer-groups --bootstrap-server kafka:9092 --describe --group opcua-group
   
   # è°ƒæ•´æ¶ˆè´¹è€…æ•°é‡
   docker-compose scale kafka-consumer=3
   ```

3. **Rediså†…å­˜ä¸è¶³**
   ```bash
   # æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
   redis-cli info memory
   
   # è°ƒæ•´ç¼“å­˜ç­–ç•¥
   redis-cli config set maxmemory-policy allkeys-lru
   ```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ è”ç³»ä¿¡æ¯

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤Issue: [GitHub Issues](https://github.com/yourusername/data-collection-system/issues)
- é‚®ç®±: your.email@example.com

## ğŸ–ï¸ é¡¹ç›®äº®ç‚¹

1. **å·¥ä¸šçº§å¯é æ€§**: ç»è¿‡å•¤é…’å·¥å‚å®é™…ç¯å¢ƒéªŒè¯ï¼Œç¨³å®šè¿è¡Œè¶…è¿‡6ä¸ªæœˆ
2. **é«˜æ€§èƒ½è®¾è®¡**: å•èŠ‚ç‚¹æ”¯æŒ1000+ Tagå¹¶å‘é‡‡é›†ï¼Œå»¶è¿Ÿä½äº100ms
3. **å®Œæ•´çš„é«˜å¯ç”¨æ–¹æ¡ˆ**: å®ç°ä»é‡‡é›†åˆ°å­˜å‚¨çš„å…¨é“¾è·¯å†—ä½™
4. **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: é‡‡ç”¨C++17ã€å®¹å™¨åŒ–ã€å¾®æœåŠ¡æ¶æ„
5. **å®Œå¤‡çš„è¿ç»´æ”¯æŒ**: æä¾›ç›‘æ§ã€å‘Šè­¦ã€æ•…éšœæ¼”ç»ƒå…¨å¥—æ–¹æ¡ˆ

---

**â­ï¸ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹ä¸ªStaræ”¯æŒï¼**